<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Link Call</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>📞</text></svg>">
    
    <!-- PWA Configuration -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#6c5ce7">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Link Call">
    <link rel="apple-touch-icon" href="/icon-192.png">
    
    <link rel="stylesheet" href="style.css">
    <!-- Twilio Voice SDK v2.11 from unpkg -->
    <script src="https://unpkg.com/@twilio/voice-sdk@2.11.2/dist/twilio.min.js"></script>
</head>
<body>
    <div class="stars" id="stars"></div>
    <div class="container">
        <!-- الشريط الجانبي -->
        <div class="sidebar">
            <div class="menu-item active" id="dialpad-btn">
                <div class="icon">📞</div>
                <div class="label">لوحة المفاتيح</div>
            </div>
            
            <div class="menu-item" id="contacts-btn">
                <div class="icon">👥</div>
                <div class="label">جهات الاتصال</div>
            </div>
            
            <div class="menu-item" id="call-history-btn">
                <div class="icon">📅</div>
                <div class="label">سجل المكالمات</div>
            </div>
            
            <div class="menu-item" id="recordings-btn">
                <div class="icon notification">🎙️</div>
                <span class="badge hidden" id="recordings-badge">0</span>
                <div class="label">المحفوظات</div>
            </div>
            
            <div class="menu-item" id="settings-btn">
                <div class="icon">⚙️</div>
                <div class="label">الإعدادات</div>
            </div>
            
            <div class="bottom-logo-container">
                <img src="logo.jpg" alt="Link Call" class="bottom-logo-img">
                <div class="online-indicator"></div>
            </div>
        </div>

        <!-- المحتوى الرئيسي -->
        <div class="main-content">
            <div class="header">
                <div class="header-top">
                    <h1>رقم الهاتف</h1>
                    <div class="user-info-header">
                        <div class="user-badge">
                            <span class="user-icon">👤</span>
                            <div class="user-text">
                                <span class="user-name-header" id="header-username">--</span>
                                <span class="user-role-header" id="header-role">--</span>
                            </div>
                        </div>
                        <button class="logout-header-btn" id="logout-header-btn" title="تسجيل خروج">
                            <span class="logout-icon">🚪</span>
                            <span class="logout-text">خروج</span>
                        </button>
                    </div>
                </div>
                <div class="phone-display">
                    <div class="phone-number" id="display-number"></div>
                    <button class="delete-btn hidden" id="delete-btn">⌫</button>
                </div>
            </div>

            <!-- لوحة الأرقام -->
            <div class="dialpad" id="dialpad">
                <div class="number-pad">
                    <button class="num-btn" data-num="1">
                        <span class="number">1</span>
                    </button>
                    <button class="num-btn" data-num="2">
                        <span class="number">2</span>
                        <span class="letters">ABC</span>
                    </button>
                    <button class="num-btn" data-num="3">
                        <span class="number">3</span>
                        <span class="letters">DEF</span>
                    </button>
                    
                    <button class="num-btn" data-num="4">
                        <span class="number">4</span>
                        <span class="letters">GHI</span>
                    </button>
                    <button class="num-btn" data-num="5">
                        <span class="number">5</span>
                        <span class="letters">JKL</span>
                    </button>
                    <button class="num-btn" data-num="6">
                        <span class="number">6</span>
                        <span class="letters">MNO</span>
                    </button>
                    
                    <button class="num-btn" data-num="7">
                        <span class="number">7</span>
                        <span class="letters">PQRS</span>
                    </button>
                    <button class="num-btn" data-num="8">
                        <span class="number">8</span>
                        <span class="letters">TUV</span>
                    </button>
                    <button class="num-btn" data-num="9">
                        <span class="number">9</span>
                        <span class="letters">WXYZ</span>
                    </button>
                    
                    <button class="num-btn" data-num="*">
                        <span class="number">*</span>
                    </button>
                    <button class="num-btn" data-num="0">
                        <span class="number">0</span>
                        <span class="letters">+</span>
                    </button>
                    <button class="num-btn" data-num="#">
                        <span class="number">#</span>
                    </button>
                </div>

                <button class="call-btn" id="call-btn">
                    📞
                </button>

                <div class="quick-dial">اتصال سريع</div>
            </div>

            <!-- شاشة المكالمة -->
            <div class="call-screen hidden" id="call-screen">
                <div class="call-info">
                    <div class="call-status" id="call-status">جاري الاتصال...</div>
                    <div class="call-number" id="call-number"></div>
                    <div class="call-duration" id="call-duration">00:00</div>
                    <div class="recording-status hidden" id="recording-status">
                        🔴 جاري التسجيل
                    </div>
                </div>
                
                <div class="call-controls">
                    <button class="control-btn" id="mute-btn">
                        <span class="icon">🔇</span>
                        <span class="label">كتم الصوت</span>
                    </button>
                    <button class="control-btn" id="hold-btn">
                        <span class="icon">⏸️</span>
                        <span class="label">إيقاف مؤقت</span>
                    </button>
                    <button class="control-btn end-call" id="end-call-btn">
                        <span class="icon">📞</span>
                        <span class="label">إنهاء</span>
                    </button>
                </div>
            </div>

            <!-- سجل المكالمات -->
            <div class="call-history-list hidden" id="call-history-list">
                <h2>سجل المكالمات</h2>
                <div id="call-history-container">
                    <div class="empty-state">
                        <div class="empty-icon">📞</div>
                        <p>لا توجد مكالمات حتى الآن</p>
                    </div>
                </div>
            </div>

            <!-- جهات الاتصال -->
            <div class="contacts-list hidden" id="contacts-list">
                <div class="contacts-header">
                    <h2>جهات الاتصال</h2>
                    <button class="add-contact-btn" id="add-contact-btn">
                        <span>+</span> إضافة جهة اتصال
                    </button>
                </div>
                <div class="search-box">
                    <input type="text" id="contact-search" placeholder="ابحت عن جهة اتصال...">
                    <span class="search-icon">🔍</span>
                </div>
                <div id="contacts-container">
                    <div class="empty-state">
                        <div class="empty-icon">👥</div>
                        <p>لا توجد جهات اتصال</p>
                        <button class="add-contact-btn-empty">إضافة جهة اتصال</button>
                    </div>
                </div>
            </div>

            <!-- قائمة التسجيلات -->
            <div class="recordings-list hidden" id="recordings-list">
                <h2>التسجيلات المحفوظة</h2>
                <div id="recordings-container"></div>
            </div>

            <!-- الإعدادات -->
            <div class="settings-panel hidden" id="settings-panel">
                <h2>الإعدادات</h2>
                <div class="settings-content">
                    <div class="settings-section">
                        <div class="settings-header">
                            <div class="app-icon">
                                <img src="logo.jpg" alt="Link Call">
                            </div>
                            <div class="app-info">
                                <h3>Link Call</h3>
                                <p class="version">الإصدار 1.0.0</p>
                                <p class="build-date">بناء December 7, 2025</p>
                            </div>
                        </div>
                    </div>

                    <!-- قسم معلومات الحساب (للمطور فقط) -->
                    <div class="settings-section" id="admin-account-section" style="display: none;">
                        <h4>معلومات الحساب</h4>
                        <div class="setting-item">
                            <span class="setting-label">رقمك الشخصي</span>
                            <input type="tel" id="user-phone-number" class="setting-input" placeholder="+966559902557" value="">
                        </div>
                        <div class="setting-item">
                            <span class="setting-label">رقم Twilio</span>
                            <span class="setting-value">+1 320 433 6644</span>
                        </div>
                        <div class="setting-item">
                            <span class="setting-label">حالة الاتصال</span>
                            <span class="setting-value status-online">متصل</span>
                        </div>
                    </div>

                    <!-- قسم إعدادات الصوت (للمطور فقط) -->
                    <div class="settings-section" id="admin-audio-section" style="display: none;">
                        <h4>إعدادات الصوت</h4>
                        <div class="setting-item">
                            <span class="setting-label">تسجيل المكالمات تلقائياً</span>
                            <label class="switch">
                                <input type="checkbox" id="auto-record" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <span class="setting-label">جودة الصوت</span>
                            <select class="setting-select">
                                <option value="high">عالية</option>
                                <option value="medium" selected>متوسطة</option>
                                <option value="low">منخفضة</option>
                            </select>
                        </div>
                    </div>

                    <!-- قسم إدارة المديرين (للأدمن فقط) -->
                    <div class="settings-section" id="employee-management-section" style="display: none;">
                        <h4>إدارة المديرين</h4>
                        <div id="employees-list" class="employees-list"></div>
                    </div>

                    <div class="settings-section">
                        <h4>الإشعارات</h4>
                        <div class="setting-item">
                            <span class="setting-label">إشعارات المكالمات الواردة</span>
                            <label class="switch">
                                <input type="checkbox" id="call-notifications" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <span class="setting-label">صوت الرنين</span>
                            <label class="switch">
                                <input type="checkbox" id="ringtone-sound" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>

                    <!-- قسم تعديل الملف الشخصي (للمديرين فقط) -->
                    <div class="settings-section" id="employee-profile-section" style="display: none;">
                        <h4>✏️ الملف الشخصي</h4>
                        <div class="form-group">
                            <label>الاسم الكامل:</label>
                            <input type="text" id="profile-fullname" placeholder="الاسم الكامل" class="setting-input">
                        </div>
                        <div class="form-group">
                            <label>رقم الهاتف:</label>
                            <input type="tel" id="profile-phone" placeholder="+966..." class="setting-input">
                        </div>
                        <div class="form-group">
                            <label>كلمة المرور الحالية:</label>
                            <input type="password" id="profile-current-password" placeholder="كلمة المرور الحالية" class="setting-input">
                        </div>
                        <div class="form-group">
                            <label>كلمة المرور الجديدة:</label>
                            <input type="password" id="profile-new-password" placeholder="اتركها فارغة إن لم ترد التغيير" class="setting-input">
                        </div>
                        <button class="btn-primary" id="update-profile-btn">💾 حفظ التعديلات</button>
                    </div>

                    <!-- قسم إدارة المديرين (للمطور فقط) -->
                    <div class="settings-section" id="employees-section" style="display: none;">
                        <h4>🔐 إدارة المديرين</h4>
                        <div class="employees-container">
                            <div class="add-employee-form">
                                <h5>إضافة مدير جديد</h5>
                                <div class="form-group">
                                    <input type="text" id="emp-username" placeholder="اسم المستخدم" required>
                                </div>
                                <div class="form-group">
                                    <input type="password" id="emp-password" placeholder="كلمة المرور" required>
                                </div>
                                <div class="form-group">
                                    <input type="text" id="emp-fullname" placeholder="الاسم الكامل" required>
                                </div>
                                <div class="form-group">
                                    <input type="tel" id="emp-phone" placeholder="رقم الهاتف (+966...)" required>
                                </div>
                                <div class="form-group">
                                    <label>القسم:</label>
                                    <select id="emp-department" class="setting-select" required>
                                        <option value="">-- اختر القسم --</option>
                                        <option value="1">الحجوزات</option>
                                        <option value="2">المبيعات</option>
                                        <option value="3">خدمة العملاء</option>
                                        <option value="4">الحسابات</option>
                                        <option value="5">الدعم الفنى</option>
                                        <option value="6">الشكاوى والاقتراحات</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label style="font-weight: bold; margin-bottom: 10px; display: block;">🔐 الصلاحيات:</label>
                                    <div style="display: grid; gap: 8px; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 5px;">
                                            <input type="checkbox" id="emp-perm-view-own-recordings" style="width: auto;">
                                            <span>📹 مشاهدة التسجيلات الخاصة</span>
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 5px;">
                                            <input type="checkbox" id="emp-perm-view-all-recordings" style="width: auto;">
                                            <span>📊 مشاهدة التسجيلات العامة</span>
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 5px;">
                                            <input type="checkbox" id="emp-perm-delete-recordings" style="width: auto;">
                                            <span>🗑️ مسح التسجيل</span>
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 5px;">
                                            <input type="checkbox" id="emp-perm-edit-profile" style="width: auto;">
                                            <span>✏️ تعديل الملف الشخصي</span>
                                        </label>
                                    </div>
                                </div>
                                <button class="add-employee-btn" id="add-employee-btn">➕ إضافة مدير</button>
                            </div>
                            
                            <div class="employees-list">
                                <h5>المديرين الحاليين</h5>
                                <div id="employees-list-container">
                                    <!-- سيتم إضافة المديرين هنا -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h4>عنا</h4>
                        <div class="about-text">
                            <p>Link Call - تطبيق مكالمات سحابي متكامل مع Twilio</p>
                            <p class="copyright">© 2025 ENG/AKRAM ELMASRY. جميع الحقوق محفوظة.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- حالة الاتصال -->
        <div class="connection-status" id="connection-status">
            <span class="status-dot"></span>
            <span id="status-text">جاري الاتصال بـ Twilio...</span>
        </div>
    </div>

    <script>
        // التحقق من تسجيل الدخول
        if (!sessionStorage.getItem('isLoggedIn')) {
            window.location.href = 'login.html';
        }
    </script>
    <!-- App Script - REST API Mode -->
    <script src="app.js"></script>
    
    <script>
        // إنشاء النجوم المتحركة
        function createStars() {
            const starsContainer = document.getElementById('stars');
            const numberOfStars = 100;
            
            for (let i = 0; i < numberOfStars; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 3 + 's';
                star.style.animationDuration = (Math.random() * 3 + 2) + 's';
                starsContainer.appendChild(star);
            }
        }
        
        createStars();
    </script>
</body>
</html>
